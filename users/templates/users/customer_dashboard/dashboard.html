{% extends 'users/customer_dashboard/base.html' %}
{% load static %}
{% block content %}
<style>
    body { font-family: Arial, sans-serif; text-align: center; }
    .calendar-container { max-width: 400px; margin: auto; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 10px; }
    .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin: auto; }
    .day { padding: 15px; border: 1px solid #ddd; cursor: pointer; position: relative; }
    .day:hover { background: #f3f3f3; }
    .reminder-bell { position: absolute; top: 5px; right: 5px; color: gold; display: none; }
    .popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2); }
    .popup textarea { width: 100%; height: 80px; }
    .popup button { margin-top: 10px; }
    .reminder-list { list-style: none; padding: 0; }
    .reminder-list li { display: flex; justify-content: space-between; align-items: center; padding: 5px; border-bottom: 1px solid #ddd; }
    .delete-btn { background: red; color: white; border: none; cursor: pointer; padding: 5px; }
</style>







<div class="admin-welcome">
    <div class="admin-c">
        <img src="{% static 'my_site/img/admin.jpg' %}" alt="background photo" />
        <div class="well-text">
            <h1>Welcome back, {{user}}!</h1>
        </div>

    </div>


    <div class="stat-container">
        <div class="calendar-container">
            <div class="calendar-header">
                <button onclick="prevMonth()">&#9664;</button>
                <h2 id="monthYear"></h2>
                <button onclick="nextMonth()">&#9654;</button>
            </div>
            <div class="calendar" id="calendar"></div>
        </div>
        
        <div class="popup" id="popup">
            <h3>Add Reminder</h3>
            <textarea id="reminderText"></textarea>
            <br>
            <button onclick="addReminder()">Add</button>
            <ul class="reminder-list" id="reminderList"></ul>
            <button onclick="closePopup()">Close</button>
        </div>
    
        <div class="stat">

            <h2>Total Cars Booked</h2>

            <p>{{ bookings_id }}</p>


        </div>
        <div class="stat">

            <h2>Total Cars Available</h2>

            <p>{{ cars_available }}</p>

        </div>
        
    </div>
</div>





<script>
    const calendar = document.getElementById("calendar");
    const popup = document.getElementById("popup");
    const reminderText = document.getElementById("reminderText");
    const reminderList = document.getElementById("reminderList");
    const monthYear = document.getElementById("monthYear");
    let selectedDay;
    let currentDate = new Date();
    
    function generateCalendar(year, month) {
        calendar.innerHTML = "";
        monthYear.textContent = new Date(year, month).toLocaleString("default", { month: "long", year: "numeric" });
        let firstDay = new Date(year, month, 1).getDay();
        let daysInMonth = new Date(year, month + 1, 0).getDate();
        
        for (let i = 0; i < firstDay; i++) {
            let emptyDiv = document.createElement("div");
            calendar.appendChild(emptyDiv);
        }
        
        for (let i = 1; i <= daysInMonth; i++) {
            let dayDiv = document.createElement("div");
            dayDiv.classList.add("day");
            dayDiv.innerHTML = `<span>${i}</span> <i class='fa fa-bell reminder-bell'></i>`;
            dayDiv.onclick = () => openPopup(dayDiv, year, month, i);
            
            let reminderKey = `reminder-${year}-${month}-${i}`;
            if (localStorage.getItem(reminderKey)) {
                dayDiv.querySelector(".reminder-bell").style.display = "inline";
            }
            
            calendar.appendChild(dayDiv);
        }
    }
    
    function openPopup(dayDiv, year, month, day) {
        selectedDay = { dayDiv, year, month, day };
        let reminderKey = `reminder-${year}-${month}-${day}`;
        let reminders = JSON.parse(localStorage.getItem(reminderKey)) || [];
        reminderList.innerHTML = "";
        reminders.forEach((reminder, index) => {
            let li = document.createElement("li");
            li.innerHTML = `${reminder} <button class='delete-btn' onclick='deleteReminder(${index})'>X</button>`;
            reminderList.appendChild(li);
        });
        popup.style.display = "block";
    }
    
    function addReminder() {
        if (reminderText.value.trim() !== "") {
            let reminderKey = `reminder-${selectedDay.year}-${selectedDay.month}-${selectedDay.day}`;
            let reminders = JSON.parse(localStorage.getItem(reminderKey)) || [];
            reminders.push(reminderText.value.trim());
            localStorage.setItem(reminderKey, JSON.stringify(reminders));
            selectedDay.dayDiv.querySelector(".reminder-bell").style.display = "inline";
            reminderText.value = "";
            openPopup(selectedDay.dayDiv, selectedDay.year, selectedDay.month, selectedDay.day);
        }
    }
    
    function deleteReminder(index) {
        let reminderKey = `reminder-${selectedDay.year}-${selectedDay.month}-${selectedDay.day}`;
        let reminders = JSON.parse(localStorage.getItem(reminderKey)) || [];
        reminders.splice(index, 1);
        localStorage.setItem(reminderKey, JSON.stringify(reminders));
        openPopup(selectedDay.dayDiv, selectedDay.year, selectedDay.month, selectedDay.day);
    }
    
    function closePopup() {
        popup.style.display = "none";
    }
    
    function prevMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    }
    
    function nextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
    }
    
    generateCalendar(currentDate.getFullYear(), currentDate.getMonth());
</script>
















{% endblock %}