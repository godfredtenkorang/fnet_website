{% extends 'my_site/base.html' %} {% load static %} {% block content %}

<!-- bannerr -->

<div class="banner">
  <img src="{% static 'my_site/img/background2.jpg' %}" alt="background photo" />
  <div class="banner-text">
    <h1>Detail of {{car.car_name}}</h1>
  </div>
</div>




<div class="car-detail-section">
  <div class="car-name">
    <h2>{{ car.car_name }}</h2>
    <p class="price">
      <strong>Price</strong> GH¢{{ car.price_within_kumasi }} per day
    </p>
  </div>
  <div class="car-detail-image">

    <div class="car-images">
      <div class="car-big-img">
        <img id="bigImage" src="{{ car.image1.url }}" alt="Big Image" />
      </div>
      <div class="small-img">
        <img class="small-thumbnail" src="{{ car.image1.url }}" />
        <img class="small-thumbnail" src="{{ car.image2.url }}" alt="Thumbnail 2" />
        <img class="small-thumbnail" src="{{ car.image3.url }}" alt="Thumbnail 3" />
        <img class="small-thumbnail" src="{{ car.image4.url }}" alt="Thumbnail 4" />
      </div>

      <div class="car-detail">
        <h4>Description</h4>
        <p>
          {{ car.description }}
        </p>
      </div>

      <div class="car-features-container">
        <h4>Car Features</h4>
        <div class="car-features">
          <li><strong>Engine Capacity:</strong> {{car.engine_capacity}}</li>
          <li><strong>Fuel Type:</strong> {{car.fuel_type}}</li>
          <li><strong>Seats:</strong> {{ car.seats }}</li>
          <li><strong>Transmission:</strong> {{car.transmission}}</li>
          <li><strong>Air Conditioning:</strong> {{car.air_conditioning}}</li>
          <li><strong>Airbag:</strong> {{car.airbag}}</li>
          <li><strong>Color:</strong> {{car.color}}</li>
          <li><strong>Make:</strong> {{car.brand}}</li>
          <li><strong>Year Manufactured:</strong> {{car.year_manufactured}}</li>
          <li><strong>Cancellation Terms:</strong> Flexible</li>
          <li><strong>Year Registered:</strong> {{car.year_registered}}</li>
        </div>

      </div>
    </div>

  </div>
  <!-- <div class="car-detail-text">
   
    <ul class="car-details-list">
        <li><strong>Make:</strong> {{car.brand}}</li>
        <li><strong>Year Manufactured:</strong> {{car.year_manufactured}}</li>
        <li><strong>Transmission Type:</strong> {{car.transmission}}</li>
        <li><strong>Cancellation Terms:</strong> Flexible</li>
      </ul>
      <div class="book-btn">
        
      </div>
</div> -->
</div>


<div class="contact-us-section booking-container">

  <div class=" book-contact">
    <p>Fill out the from below to book for your favourite car</p>
    <form method="POST">
      {% csrf_token %}
      <br>
      <div class="input-flex">

        <div class="input">
          <label for="">Name </label> <br>
          <input type="text" name="customer_name" id="customer_name" required placeholder="TL Ghana">
        </div>

        <div class="input">
          <label for="">Phone </label> <br>
          <input class="amount-input" type="text" name="customer_phone" id="customer_phone" required
            placeholder="0550222888">
        </div>
        <!-- Hidden JSON Data for Pricing -->
        <script type="application/json" id="pricing_data">
                {
                    "within_kumasi": "{{ car.price_within_kumasi }}",
                    "ahafo_region": "{{ car.ahafo_region_price }}",
                    "ashanti_region": "{{ car.ashanti_region_price }}",
                    "bono_region": "{{ car.bono_region_price }}",
                    "bono_east_region": "{{ car.bono_east_region_price }}",
                    "central_region": "{{ car.central_region_price }}",
                    "eastern_region": "{{ car.eastern_region_price }}",
                    "greater_accra_region": "{{ car.greater_accra_region_price }}",
                    "northern_region": "{{ car.northern_region_price }}",
                    "north_east_region": "{{ car.north_east_region_price }}",
                    "oti_region": "{{ car.oti_region_price }}",
                    "savannah_region": "{{ car.savannah_region_price }}",
                    "upper_east_region": "{{ car.upper_east_region_price }}",
                    "upper_west_region": "{{ car.upper_west_region_price }}",
                    "volta_region": "{{ car.volta_region_price }}",
                    "western_region": "{{ car.western_region_price }}",
                    "western_north_region": "{{ car.western_north_region_price }}"
                }
        </script>
        <div class="input">
          <label for="location_category">Region:</label>
          <select id="location_category" name="location_category" required>
            <option value="within_kumasi">Within Kumasi</option>
            <option value="ahafo_region">Ahafo Region</option>
            <option value="ashanti_region">Ashanti Region</option>
            <option value="bono_region">Bono Region</option>
            <option value="bono_east_region">Bono East Region</option>
            <option value="central_region">Central Region</option>
            <option value="eastern_region">Eastern Region</option>
            <option value="greater_accra_region">Greater Accra Region</option>
            <option value="northern_region">Northern Region</option>
            <option value="north_east_region">North East Region</option>
            <option value="oti_region">Oti Region</option>
            <option value="savannah_region">Savannah Region</option>
            <option value="upper_east_region">Upper East Region</option>
            <option value="upper_west_region">Upper West Region</option>
            <option value="volta_region">Volta Region</option>
            <option value="western_region">Western Region</option>
            <option value="western_north_region">Western North Region</option>
          </select>
        </div>
        <h3>Region Price: GH¢<span id="price_display">0.00</span></h3>
        <br>
        <div class="input">
          <label for="">City </label> <br>
          <input type="text" name="city" id="city" required placeholder="eg. Koforidua, Sunyani, Kumasi etc">
        </div>
        <div class="input">
          <label for="">Town </label> <br>
          <input type="text" name="town" id="town" required placeholder="eg. New Tafo, STU, Adum etc">
        </div>
        <div class="input">
          <label for="">Pick up Time</label> <br>
          <input type="time" name="pick_up_time" required>
        </div>
        <div class="input">
          <label for="">Drop off Time</label> <br>
          <input type="time" name="drop_off_time" required>
        </div>
      </div>
      <div class="input-flex">
        <div class="input">
          <label for="">Rental date</label> <br>
          <input type="date" name="rental_date" id="rental_date" required>
        </div>
        <div class="input">
          <label for="">Return Date</label> <br>
          <input type="date" name="return_date" id="return_date" required>
        </div>
        <div class="input">
          <label for="">Document Type</label> <br>
          <select name="document_type" id="document_type">
            <option value="Ghana Card">Ghana Card</option>
            <option value="Passport">Passport</option>
          </select>
        </div>
        <div class="input">
          <label for="">Document No. </label> <br>
          <input type="text" name="document_number" id="document_number" required placeholder="GHA-xxxxxxxxxxxx-x">
        </div>
      </div>

      <h3>Total Price: GH¢<span id="total_price">0.00 </span></h3>
      <p class="negotiable_message" id="negotiable_message"></p>
      <br>
      <h3>NB: Book now if you want to make payment at the office.</h3>
      <br>
      <button type="submit">Pay on Arrival</button>


    </form>
    <!-- <div class="exp-btn">
      <a style="color:black;" href="{% url 'assign-driver' car.id %}">View Expenses</a>
    </div> -->
    <a href="{% url 'process-payment' car.slug  %}">
      <button class="payOnarrival">Pay before Arrival </button>
    </a>
  </div>
</div>
<script>
  const pricePerDay = "{{ car.price_per_day }}"

  document.getElementById('rental_date').addEventListener('change', updateTotalPrice);
  document.getElementById('return_date').addEventListener('change', updateTotalPrice);
  document.getElementById('location_category').addEventListener('change', updateTotalPrice);

  function updateTotalPrice() {
    const rentalDate = new Date(document.getElementById('rental_date').value);
    const returnDate = new Date(document.getElementById('return_date').value);
    const location_category = document.getElementById('location_category').value;
    const pricing = JSON.parse(document.getElementById('pricing_data').textContent);
    const priceDisplay = document.getElementById("price_display");
    const negotiableMessage = document.getElementById('negotiable_message');


    if (rentalDate && returnDate && rentalDate < returnDate) {
      if (pricing[location_category]) {
        priceDisplay.textContent = `GH¢ ${pricing[location_category]}`
      } else {
        priceDisplay.textContent = "Select a valid location";
      }
      

      const timeDiff = returnDate - rentalDate;
      const rentalDays = Math.ceil(timeDiff / (1000 * 3600 * 24));



      const totalPrice = rentalDays * (pricing[location_category]);


      document.getElementById('total_price').innerHTML = totalPrice.toFixed(2);
    } else {
      document.getElementById('total_price').innerHTML = "0.00";
    }

    if (rentalDate && returnDate) {
      const difference = (returnDate - rentalDate) / (1000 * 60 * 45 * 24);
      if (difference > 3) {
        negotiableMessage.textContent = "(Negotiable)";
        negotiableMessage.style.color = "red";
      } else {
        negotiableMessage.textContent = "";
      }
    }
  }

</script>

{% endblock %}