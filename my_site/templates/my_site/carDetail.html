{% extends 'my_site/base.html' %} {% load static %} {% block content %}

<!-- bannerr -->

<div class="banner">
  <img src="{% static 'my_site/img/background2.jpg' %}" alt="background photo" />
  <div class="banner-text">
    <h1>Detail of {{car.car_name}}</h1>
  </div>
</div>




<div class="car-detail-section">
  <div class="car-name">
    <h2>{{ car.car_name }}</h2>
    <p class="price">
      <strong>Price</strong> GH¢{{ car.price_within_kumasi }} per day
    </p>
  </div>
  <div class="car-detail-image">

    <div class="car-images">
      <div class="car-big-img">
        <img id="bigImage" src="{{ car.image1.url }}" alt="Big Image" />
      </div>
      <div class="small-img">
        <img class="small-thumbnail" src="{{ car.image1.url }}" />
        <img class="small-thumbnail" src="{{ car.image2.url }}" alt="Thumbnail 2" />
        <img class="small-thumbnail" src="{{ car.image3.url }}" alt="Thumbnail 3" />
        <img class="small-thumbnail" src="{{ car.image4.url }}" alt="Thumbnail 4" />
      </div>

      <div class="car-detail">
        <h4>Description</h4>
        <p>
          {{ car.description }}
        </p>
      </div>

      <div class="car-features-container">
        <h4>Car Features</h4>
        <div class="car-features">
          <li><strong>Fuel Type:</strong> {{car.fuel_type}}</li>
          <li><strong>Seats:</strong> {{ car.seats }}</li>
          <li><strong>Transmission:</strong> {{car.transmission}}</li>
          <li><strong>Air Conditioning:</strong> {{car.air_conditioning}}</li>
          <li><strong>Airbag:</strong> {{car.airbag}}</li>
          <li><strong>Mileage:</strong> {{car.mileage}}</li>
          <li><strong>GPS Navigation:</strong> {{car.gps_navigation}}</li>
          <li><strong>Bluetooth Connectivity:</strong> {{car.bluetooth_connectivity}}</li>
          <li><strong>Color:</strong> {{car.color}}</li>
          <li><strong>Make:</strong> {{car.brand}}</li>
          <li><strong>Year Manufactured:</strong> {{car.year_manufactured}}</li>
          <li><strong>Cancellation Terms:</strong> Flexible</li>
          <li><strong>Year Registered:</strong> {{car.year_registered}}</li>
        </div>

      </div>
    </div>

  </div>
  <!-- <div class="car-detail-text">
   
    <ul class="car-details-list">
        <li><strong>Make:</strong> {{car.brand}}</li>
        <li><strong>Year Manufactured:</strong> {{car.year_manufactured}}</li>
        <li><strong>Transmission Type:</strong> {{car.transmission}}</li>
        <li><strong>Cancellation Terms:</strong> Flexible</li>
      </ul>
      <div class="book-btn">
        
      </div>
</div> -->
</div>


<div class="contact-us-section booking-container">

  <div class=" book-contact">
    <p>Fill out the from below to book for your favourite car</p>
    <form method="POST">
      {% csrf_token %}
      <br>
      <div class="input-flex">

        <div class="input">
          <label for="">Name </label> <br>
          <input type="text" name="customer_name" id="customer_name" required placeholder="TL Ghana">
        </div>

        <div class="input">
          <label for="">Phone </label> <br>
          <input class="amount-input" type="text" name="customer_phone" id="customer_phone" required
            placeholder="0550222888">
        </div>
        <div class="input">
          <label for="">Region</label> <br>
          <select name="region" id="region">
            {% for region in regions %}
            <option value="{{ region.id }}">{{region.name}}</option>
            {% endfor %}

          </select>
        </div>
        
        <!-- Hidden JSON Data for Pricing -->
        <script type="application/json" id="pricing_data">
                {
                    "within_kumasi": "{{ car.price_within_kumasi }}",
                    "outside_kumasi_inside_ashanti": "{{ car.price_outside_kumasi_inside_ashanti }}",
                    "outside_ashanti_to_next_region": "{{ car.price_outside_ashanti_to_next_region }}",
                    "outside_ashanti_to_next_two_regions": "{{ car.price_outside_ashanti_to_next_two_regions }}",
                    "outside_ashanti_to_next_three_regions": "{{ car.price_outside_ashanti_to_next_three_regions }}"
                }
        </script>
        <div class="input">
          <label for="location_category">Location:</label>
          <select id="location_category" name="location_category" required>
            
            <option value="within_kumasi">Within Kumasi</option>
            <option value="outside_kumasi_inside_ashanti">Outside Kumasi (Inside Ashanti Region)</option>
            <option value="outside_ashanti_to_next_region">Outside Ashanti Region (Next Region)</option>
            <option value="outside_ashanti_to_next_two_regions">Outside Ashanti Region (Next Two Regions)</option>
            <option value="outside_ashanti_to_next_three_regions">Outside Ashanti Region (Next Three Regions)</option>
          </select>
        </div>
        <h3>Location Price: GH¢<span id="price_display">0.00</span></h3>
        <br>
        <div class="input">
          <label for="">Town </label> <br>
          <input type="text" name="town" id="town" required placeholder="eg. Adum, Offinso, Koforidua etc">
        </div>
        <div class="input">
          <label for="">Pick up Time</label> <br>
          <input type="time" name="pick_up_time" required>
        </div>
        <div class="input">
          <label for="">Drop off Time</label> <br>
          <input type="time" name="drop_off_time" required>
        </div>
      </div>

      <!-- <div class="input">
    
                    <label for="">With a driver?</label> <br>
                    <select name="" id="">
                        <option value=""> With a driver</option>
                        <option value=""> Without a driver</option>
                    </select>
                </div> -->


      <div class="input-flex">
        <div class="input">
          <label for="">Rental date</label> <br>
          <input type="date" name="rental_date" id="rental_date" required>
        </div>
        <div class="input">
          <label for="">Return Date</label> <br>
          <input type="date" name="return_date" id="return_date" required>
        </div>
        <div class="input">
          <label for="">Document Type</label> <br>
          <select name="document_type" id="document_type">
            <option value="Ghana Card">Ghana Card</option>
            <option value="Passport">Passport</option>
          </select>
        </div>
        <div class="input">
          <label for="">Document No. </label> <br>
          <input type="text" name="document_number" id="document_number" required placeholder="GHA-xxxxxxxxxxxx-x">
        </div>
      </div>








      <h3>Total Price: GH¢<span id="total_price">0.00</span></h3>
      <br>
      <h3>NB: Book now if you want to make payment at the office.</h3>
      <br>
      <button type="submit">Pay on Arrival</button>


    </form>
    <!-- <div class="exp-btn">
      <a style="color:black;" href="{% url 'assign-driver' car.id %}">View Expenses</a>
    </div> -->
    <a href="{% url 'process-payment' car.slug  %}">
      <button class="payOnarrival">Pay before Arrival </button>
    </a>
  </div>
</div>

<script>
  const pricePerDay = "{{ car.price_per_day }}"

  document.getElementById('rental_date').addEventListener('change', updateTotalPrice);
  document.getElementById('return_date').addEventListener('change', updateTotalPrice);
  document.getElementById('location_category').addEventListener('change', updateTotalPrice);

  function updateTotalPrice() {
    const rentalDate = new Date(document.getElementById('rental_date').value);
    const returnDate = new Date(document.getElementById('return_date').value);
    const location_category = document.getElementById('location_category').value;
    const pricing = JSON.parse(document.getElementById('pricing_data').textContent);
    const priceDisplay = document.getElementById("price_display");

    

    if (rentalDate && returnDate && rentalDate < returnDate) {
      if (pricing[location_category]) {
        priceDisplay.textContent = `GH¢ ${pricing[location_category]}`
      } else {
        priceDisplay.textContent = "Select a valid location";
      }

      const timeDiff = returnDate - rentalDate;
      const rentalDays = Math.ceil(timeDiff / (1000 * 3600 * 24));

      

      const totalPrice = rentalDays * (pricing[location_category]);


      document.getElementById('total_price').innerHTML = totalPrice.toFixed(2);
    } else {
      document.getElementById('total_price').innerHTML = "0.00";
    }
  }

</script>

{% endblock %}